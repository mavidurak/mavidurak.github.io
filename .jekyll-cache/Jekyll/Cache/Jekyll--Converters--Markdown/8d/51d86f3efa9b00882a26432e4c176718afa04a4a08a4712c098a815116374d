I"ˆ(<p>Merhabalar,
BugÃ¼n sizlere benim de ÅŸu sÄ±ralar yeni yeni adÄ±m atmakta olduÄŸum tersine mÃ¼hendislik ve zararlÄ± yazÄ±lÄ±m analiziyle alakalÄ±, bana ilgi Ã§ekici gelen bir konudan bahsetmek istiyorum.â€PDF Malware Analiziâ€.</p>

<p>BilindiÄŸi Ã¼zere PDF dosyalarÄ±nÄ± gÃ¼nlÃ¼k yaÅŸantÄ±mÄ±zda, iÅŸte, evde Ã§oÄŸu yerde kullanÄ±yoruz.Bu PDFler olmadan iÅŸ yaÅŸantÄ±sÄ±nÄ± hayal etmek bile oldukÃ§a zor aslÄ±nda.Ã‡Ã¼nkÃ¼ kurumsal/bireysel belgeler, ÅŸirket broÅŸÃ¼rleri ve hatta davetiyeler bile Ã§oÄŸu zaman PDF formatÄ±nda tutuluyor.<!--more--></p>

<p>GeÃ§tiÄŸimiz yÄ±llarda PDF dosyalarÄ±yla ilgili buffer overflow gibi zafiyetler yayÄ±nlandÄ± ve bu zafiyetlere yÃ¶nelik saldÄ±rÄ±lar oluÅŸmaya baÅŸladÄ±.Hatta saldÄ±rÄ±larÄ±n birÃ§oÄŸunun internet Ã¼zerinde, iÃ§inde zararlÄ± kod bulunduran PDF dosyalarÄ±nÄ±n sisteme indirilmesiyle veya bu PDF dosyalarÄ±nÄ±n sosyal mÃ¼hendislik yÃ¶ntemleri kullanÄ±larak sistemlere kullanÄ±cÄ±nÄ±n anlamayacaÄŸÄ± bir ÅŸekilde yerleÅŸtirilerek gerÃ§ekleÅŸtirildiÄŸi gÃ¶rÃ¼ldÃ¼.</p>

<p>Sadece PDF dosyasÄ±nÄ± aÃ§mak gibi basit bir hareket bile internetten gelen zararlÄ± kodun sisteme bulaÅŸmasÄ±nÄ± saÄŸlayacak bir gÃ¼venlik ihlali yaratabilir.KullanÄ±cÄ±nÄ±n anlamamasÄ± iÃ§in sahte bir PDF dosyasÄ± ÅŸekline bÃ¼rÃ¼nerek kullanÄ±cÄ±yÄ± kandÄ±rabilir.</p>

<p>Bu konuyla ilgili aÅŸaÄŸÄ±daki resimde geÃ§tiÄŸimiz yÄ±llardaki Adobe Reader saldÄ±rÄ±larÄ±nÄ±n yÃ¼zdelik artÄ±ÅŸÄ±nÄ± gÃ¶rebilirsiniz.</p>

<p><img src="http://ferdogan.net/assets/z1.png" alt="Adobe Reader SaldÄ±rÄ±larÄ±" /></p>

<p>ZararlÄ± PDF dosyalarÄ± demin bahsettiÄŸim nedenlerin de etkisiyle sÄ±klÄ±kla kitlesel Ã¶lÃ§ekli bilgisayar saldÄ±rÄ±larÄ±nÄ±n bir parÃ§asÄ± olarak kullanÄ±lÄ±r.</p>

<p>PDF dosyalarÄ±nÄ± analiz etmeyi bilmek iyi gÃ¼zel fakat analizi yapacak kiÅŸinin PDF dosya yapÄ±sÄ± hakkÄ±nda Ã¶nceden bilgisinin olmasÄ± her halÃ¼karda daha olumludur.
Ã–yleyse ÅŸimdi bizde PDF dosya yapÄ±sÄ±nÄ± inceleyelimâ€¦</p>

<h2 id="pdf-dosya-yapÄ±sÄ±">PDF Dosya YapÄ±sÄ±</h2>

<p>PDF, statik ve dinamik zengin iÃ§erik sunma yeteneÄŸine sahiptir.PDF dosyalarÄ±yla gÃ¶rsel olarak ilgi Ã§ekici, interaktif ve taÅŸÄ±nabilir belgeler sunabilirsiniz.Her ne kadar bu geniÅŸ Ã¶zellik ve imkanlardan yararlanÄ±yor olsak bile iÅŸin bir karanlÄ±k tarafÄ± vardÄ±r.Az Ã¶nce bahsettiÄŸimiz dinamik pdf Ã¶zellikleri, zararlÄ± kodlarÄ± barÄ±ndÄ±rabilecek ÅŸekilde kullanÄ±lmÄ±ÅŸtÄ±r.</p>

<p>Ã–nceki yÄ±llarda bilgisayar korsanlarÄ±nÄ±n bu tarz kÃ¶tÃ¼ niyetli dosyalarÄ±, zararlÄ± kod barÄ±ndÄ±ran kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlarÄ± yÃ¼klemek ve kullanÄ±cÄ±larÄ±n kimlik bilgilerini Ã§almak iÃ§in kullandÄ±ÄŸÄ± ortaya Ã§Ä±kmÄ±ÅŸtÄ±r.</p>

<p>Normalde PDF zararlÄ± yazÄ±lÄ±mlarÄ±, bu dosyalarÄ±n iÃ§ine gÃ¶mÃ¼len bir script sayesinde Ã§alÄ±ÅŸmakta.Bu zararlÄ± script PDF dosyasÄ±nÄ±n Ã§alÄ±ÅŸmasÄ±nÄ± destekleyen bir yapÄ±ya sahiptir.Bu amaca yÃ¶nelik en yaygÄ±n kullanÄ±lan script dili JavaScriptâ€™tir.</p>

<p>Ã‡oÄŸu durumda bu gÃ¶mÃ¼lÃ¼ scriptler iÅŸlevselliÄŸi saÄŸlamak veya iÅŸletim sistemine zararlÄ± kod yÃ¼klemek iÃ§in kullanÄ±lÄ±r.</p>

<h1 id="pdf-dÃ¶kÃ¼man-yapÄ±sÄ±">PDF DÃ¶kÃ¼man YapÄ±sÄ±</h1>

<p>Bir PDF dosyasÄ±nÄ±n genel yapÄ±sÄ± aÅŸaÄŸÄ±daki bileÅŸenlerden oluÅŸur:
	* Boolean values, representing true or false
	* Numbers
	* Strings
	* Names
	* Arrays, ordered collections of objects
	* Dictionaries, collections of objects indexed by names
	* Streams, usually containing large amounts of data
	* The null object</p>

<p><img src="http://ferdogan.net/assets/z2.png" alt="PDF Dosya YApÄ±sÄ±" /></p>

<h2 id="zararlÄ±-yazÄ±lÄ±mÄ±n-pdf-ile-Ã§alÄ±ÅŸmasÄ±">ZararlÄ± YazÄ±lÄ±mÄ±n PDF ile Ã‡alÄ±ÅŸmasÄ±</h2>

<p>Ã‡alÄ±ÅŸtÄ±rma iÅŸlemi sÄ±rasÄ±nda zararlÄ± bir uygulama aÃ§Ä±lÄ±r ya da bir belgeye veri yazdÄ±rÄ±r.
Biz bu iÅŸlemi Adobe Acrobat exploitini Metasploit ile PDF iÃ§ine .exe dosyasÄ± gÃ¶merek yapÄ±yoruz.</p>

<ul>
  <li>ZararlÄ± PDFâ€™in Ã§alÄ±ÅŸmasÄ± esnasÄ±nda cmdâ€™de aÅŸaÄŸÄ±daki eylemleri uygulayarak aÃ§Ä±lacaktÄ±r.</li>
</ul>

<p><img src="http://ferdogan.net/assets/z3.png" alt="cmd" /></p>

<p>Genellikle PDF iÃ§ine JavaScript kullanarak zararlÄ± yazÄ±lÄ±m gÃ¶mÃ¼lerek bu iÅŸlem yapÄ±lÄ±yor, Ã§Ã¼nkÃ¼ JavaScript heap spray gibi tekniklerle exploit etme yÃ¶ntemlerinde sÄ±kÃ§a kullanÄ±lÄ±r.</p>

<p>Herhangi bir kÃ¶tÃ¼ niyetli PDF dosyasÄ±nÄ± aÃ§tÄ±ÄŸÄ±nÄ±zda ilk olarak JavaScript kodu yÃ¼rÃ¼tÃ¼lecek ve exploit edilecektir.Daha sonra shellcode yÃ¼rÃ¼tÃ¼lÃ¼r ve Trojan .exe Ã§alÄ±ÅŸacaktÄ±r.</p>

<p><img src="http://ferdogan.net/assets/z3.png" alt="execute" /></p>

<h2 id="metasploit-ile-zararlÄ±-pdf-dosyasÄ±-oluÅŸturma">Metasploit ile ZararlÄ± PDF DosyasÄ± OluÅŸturma</h2>

<p>Åimdi Adobe Reader â€œutil.printf()â€ JavaScript fonksiyonundaki stack buffer overflow zafiyetini kullanarak kendi zararlÄ± PDF dosyamÄ±zÄ± oluÅŸturalÄ±m.Adobe Reader, genellikle stack-based-buffer-overflow zafiyetine meyilliymiÅŸ bende bunu yeni Ã¶ÄŸrendimâ€¦</p>

<p>Herneyse ÅŸimdi zararlÄ± PDFâ€™i Metasploit kullanarak adÄ±m adÄ±m oluÅŸturalÄ±m:</p>

<ul>
  <li>msfconsoleâ€™u aÃ§Ä±p aÅŸaÄŸÄ±daki komutlarÄ± uygulayÄ±n.</li>
</ul>

<p><img src="http://ferdogan.net/assets/mw1.png" alt="mw1" /></p>

<ul>
  <li>Gerekli ayarlamalarÄ± yaptÄ±ktan sonra <code class="language-plaintext highlighter-rouge">exploit</code> komutuyla zararlÄ± PDF dosyamÄ±zÄ± /root/.msf4/local/zararlipdf.pdf dizininde bulabilirsiniz.</li>
</ul>

<p><img src="http://ferdogan.net/assets/mw2.png" alt="mw2" /></p>

<ul>
  <li>Ä°ÅŸte badboy karÅŸÄ±mÄ±zda :)</li>
</ul>

<p><img src="http://ferdogan.net/assets/mw3.png" alt="mw3" /></p>

<ul>
  <li>ZararlÄ± PDF dosyasÄ±nÄ± gÃ¶ndermeden Ã¶nce, reverse connection saÄŸlamak iÃ§in listener aktif etmemiz lazÄ±m.</li>
</ul>

<p><img src="http://ferdogan.net/assets/mw4.png" alt="mw4" /></p>

<p>PDF dosyasÄ± aÃ§Ä±ldÄ±ÄŸÄ±nda metasploit tarafÄ±ndan bize session yani bir oturum aÃ§Ä±lacaktÄ±r.Meterpreter kullanarak sisteme eriÅŸim saÄŸlamÄ±ÅŸ olduk bÃ¶ylece.</p>

<ul>
  <li>ZararlÄ± PDFâ€™i Analiz Etme YÃ¶ntemleri
BaÅŸlÄ±ca iki analiz yÃ¶ntemi vardÄ±r: online ve offline.Åimdi bunlarÄ± inceleyelim.</li>
</ul>

<h2 id="online-pdf-analiz-araÃ§larÄ±">Online PDF Analiz AraÃ§larÄ±</h2>

<p>Online PDF Analiz araÃ§larÄ± Ã§oÄŸu zaman iÅŸleri daha da kolaylaÅŸtÄ±rÄ±yor.Siteye upload edip analizden sonra raporlarÄ± inceleyerek gerekli bilgiyi edinebiliriz.</p>

<h1 id="wepawet">Wepawet</h1>

<p>Wepawet Flash, JavaScript ve PDF dosyalarÄ±nÄ± analiz eden web tabanlÄ± online malware tarayÄ±cÄ±sÄ±.<a href="http://wepawet.iseclab.org/">Wepawet</a> baÄŸlantÄ±sÄ±ndan inceleyebilirsiniz.</p>

<ul>
  <li>PDF dosyasÄ± Detector-Result sonucununda â€œsuspiciousâ€ yani ÅŸÃ¼pheli olarak gÃ¶rÃ¼nÃ¼yor.</li>
</ul>

<p><img src="http://ferdogan.net/assets/on1.png" alt="on1" /></p>

<ul>
  <li>Exploit metodu â€œutil.printfâ€ ve shellcode..</li>
</ul>

<p><img src="http://ferdogan.net/assets/on2.png" alt="on2" /></p>

<h1 id="pdf-examiner">PDF Examiner#</h1>

<p>KÄ±rmÄ±zÄ± yazÄ±lÄ± alanda analiz sonuÃ§larÄ± belirtilmekte.<a href="http://www.malwaretracker.com/">PDF Examiner</a> adresinden ulaÅŸabilirsiniz.</p>

<p><img src="http://ferdogan.net/assets/on3.png" alt="on3" /></p>

<h1 id="jsunpack">Jsunpack</h1>

<p><a href="http://jsunpack.jeek.org/">Jsunpack</a> adresinden sisteme ulaÅŸabilirsiniz.</p>

<ul>
  <li>malicios ile baÅŸlayan ilk iki satÄ±r, zafiyet hakkÄ±nda bilgi vermekte.</li>
</ul>

<p><img src="http://ferdogan.net/assets/on4.png" alt="on4" /></p>

<h2 id="offline-pdf-analiz-araÃ§larÄ±">Offline PDF Analiz AraÃ§larÄ±</h2>

<h1 id="peepdf">Peepdf</h1>

<p>Peepdf, PDF dosyalarÄ±nÄ±n zararlÄ± olup olmadÄ±ÄŸÄ±nÄ± Ã¶ÄŸrenmek ve incelemek amacÄ±yla python dilinde geliÅŸtirilen bir araÃ§tÄ±r.
Peepdfâ€™in gÃ¼zel yanÄ±, gÃ¶revleri gerÃ§ekleÅŸtirmek iÃ§in baÅŸka araÃ§lara ihtiyacÄ± olmamasÄ±, pdf analizi iÃ§in gerekebilecek bileÅŸenleri kendi iÃ§inde barÄ±ndÄ±rmasÄ±.</p>

<ul>
  <li>
    <p>Åimdi adÄ±m adÄ±m inceleyelimâ€¦</p>
  </li>
  <li>
    <p><img src="http://ferdogan.net/assets/mw5.png" alt="mw5" /></p>
  </li>
  <li>
    <p><img src="http://ferdogan.net/assets/mw6.png" alt="mw6" /></p>
  </li>
  <li>
    <p><img src="http://ferdogan.net/assets/mw7.png" alt="mw7" /></p>
  </li>
  <li>
    <p><img src="http://ferdogan.net/assets/mw8.png" alt="mw8" /></p>
  </li>
</ul>

<h1 id="pdfid">Pdfid</h1>

<p>Pdfid, bir PDF dosyasÄ±ndan kullanÄ±ÅŸlÄ± bilgiler elde etmenizi saÄŸlayan bir araÃ§tÄ±r.Peepdf gibi Pdfidâ€™de python ile geliÅŸtirilmiÅŸtir.</p>

<p>Analiz edilen pdf dosyasÄ±ndan javascript, obj, endobj, stream gibi headerlarÄ± Ã§Ä±karabilir.BazÄ± PDF exploitleri bu tarz headerlarÄ± deÄŸiÅŸtirebilir, pdfid pdf iÃ§inde neler olduÄŸunu tam anlamÄ±yla gÃ¶sterebilir.</p>

<p><img src="http://ferdogan.net/assets/mw9.png" alt="mw9" /></p>

<h1 id="origami">Origami</h1>

<p>Origami, PDF dosyalarÄ±nÄ± parse, analiz ve forge etmek amacÄ±yla kullanÄ±lan bir Ruby frameworktÃ¼r.
Varolan PDF dosyalarÄ±na zararlÄ± kod enjekte etmek iÃ§in de kullanÄ±labilir.YakÄ±n zamanda Origami ile ilgili daha ayrÄ±ntÄ±lÄ± bir yazÄ± yazmayÄ± dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼mden, ÅŸu an ayrÄ±ntÄ±lÄ± olarak incelemiyorum.</p>

<ul>
  <li>Ekran gÃ¶rÃ¼ntÃ¼sÃ¼ ÅŸu ÅŸekilde:</li>
</ul>

<p><img src="http://ferdogan.net/assets/of2.png" alt="of2" /></p>

<h1 id="pdf-stream-dumper">PDF Stream Dumper</h1>

<p>Bu programla ilgili varolan kaynaklardan aldÄ±ÄŸÄ±m ekran gÃ¶rÃ¼ntÃ¼lerini incelemenin yeterli olduÄŸunu dÃ¼ÅŸÃ¼nÃ¼yorum.</p>

<ul>
  <li>
    <p><img src="http://ferdogan.net/assets/of3.png" alt="of3" /></p>
  </li>
  <li>
    <p><img src="http://ferdogan.net/assets/of4.png" alt="of4" /></p>
  </li>
  <li>
    <p><img src="http://ferdogan.net/assets/of6.png" alt="of6" /></p>
  </li>
</ul>

<h2 id="nasÄ±l-korunabilirim">NasÄ±l Korunabilirim??</h2>

<ul>
  <li>
    <p>Otomatik gÃ¼ncelleÅŸtirmeleri aktif edin.</p>
  </li>
  <li>
    <p>PDF dosyasÄ±nÄ±n browser ile entegre Ã§alÄ±ÅŸmasÄ±nÄ± engelleyin.</p>
  </li>
  <li>
    <p>TÃ¼m Adobe Ã¼rÃ¼nlerinin son patch ve update sÃ¼rÃ¼mlerini kullanÄ±n.</p>
  </li>
  <li>
    <p>JavaScriptâ€™i deaktif edin.</p>
  </li>
  <li>
    <p>â€œAllow non-PDF file attachments with external applicationsâ€ tarzÄ± mesaj seÃ§eneklerini iÅŸaretlemeyin.</p>
  </li>
  <li>
    <p>Alternatif PDF araÃ§larÄ±nÄ± kullanÄ±n.Foxit Reader, Sumatra, PDF XChange.</p>
  </li>
</ul>

<p>Bir baÅŸka yazÄ±da gÃ¶rÃ¼ÅŸmek dileÄŸiyle.</p>

<p><a href="http://ferdogan.net/PDF-Malware-Analiz-Teknikleri/">Kaynak</a></p>
:ET